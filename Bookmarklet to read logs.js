javascript:(function(){try{var KEY='bookingTimes';var USE_UTC=true;var SORT_ASC=true;function pad(n,l){n=String(n);while(n.length<l)n='0'+n;return n;}function fmt(d){if(USE_UTC){return pad(d.getUTCDate(),2)+'/'+pad(d.getUTCMonth()+1,2)+'/'+pad(d.getUTCFullYear(),4)+','+pad(d.getUTCHours(),2)+','+pad(d.getUTCMinutes(),2)+','+pad(d.getUTCSeconds(),2)+'.'+pad(d.getUTCMilliseconds(),3);}else{return pad(d.getDate(),2)+'/'+pad(d.getMonth()+1,2)+'/'+pad(d.getFullYear(),4)+','+pad(d.getHours(),2)+','+pad(d.getMinutes(),2)+','+pad(d.getSeconds(),2)+'.'+pad(d.getMilliseconds(),3);}}function normSpaces(s){return String(s).replace(/[\u00A0\u202F]/g,' ').replace(/\s+/g,' ').trim();}function parseUK(s){s=normSpaces(s).replace(/^\s*\d+\.\s*/,'');var re=/^(\d{2})\/(\d{2})\/(\d{4}),\s*(\d{2}):(\d{2}):(\d{2})(?:\.(\d{1,6}))?$/;var m=s.match(re);if(!m)return null;var day=+m[1],mon=+m[2],yr=+m[3],hh=+m[4],mi=+m[5],ss=+m[6];var frac=m[7]||null;var d=new Date(yr,mon-1,day,hh,mi,ss,0);var micros=frac?parseInt(frac.padEnd(6,%270%27),10):0;var addMs=Math.round(micros/1000);d.setTime(d.getTime()+addMs);return d;}function parseISO(s){s=normSpaces(s);var re=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}(?:\.\d{1,6})?Z$/;if(!re.test(s))return null;var d=new Date(s);return isFinite(d.getTime())?d:null;}function parseToString(s){s=normSpaces(s);var re=/^\w{3}\s\w{3}\s\d{1,2}\s\d{4}\s\d{2}:\d{2}:\d{2}\sGMT[+-]\d{4}/;if(!re.test(s))return null;var d=new Date(s);return isFinite(d.getTime())?d:null;}function parseGeneric(s){var d=new Date(s);return isFinite(d.getTime())?d:null;}function parseStrAny(s){return parseUK(s)||parseISO(s)||parseToString(s)||parseGeneric(s);}var raw=localStorage.getItem(KEY);if(!raw){alert(%27No data under key: %27+KEY);return;}var arr;try{arr=JSON.parse(raw);}catch(e){arr=null;}if(!arr||!arr.length){alert(%27Empty/invalid JSON under %27+KEY);return;}var rows=[],converted=0,skipped=0;for(var i=0;i<arr.length;i++){var it=arr[i];var d=null;if(typeof it===%27string%27){d=parseStrAny(it);}else if(it&&typeof it===%27object%27){if(typeof it.iso===%27string%27&&it.iso){d=parseISO(it.iso)||new Date(it.iso);}else if(typeof it.epochMsHp===%27number%27&&isFinite(it.epochMsHp)){d=new Date(it.epochMsHp);}else{d=null;}}if(d&&isFinite(d.getTime())){rows.push({t:d.getTime(),s:fmt(d)});converted++;}else{skipped++;}}if(!rows.length){alert(%27No parseable entries. Skipped=%27+skipped);return;}if(SORT_ASC){rows.sort(function(a,b){return a.t-b.t;});}var text=rows.map(function(r){return r.s;}).join(%27\r\n%27);var msg=%27Converted %27+converted+%27 entry(ies). Skipped %27+skipped+%27.%27;alert(%27Parsed entries:\r\n\r\n%27+text);if(navigator.clipboard&&navigator.clipboard.writeText){navigator.clipboard.writeText(text).then(function(){alert(msg+%27\\nCSV copied to clipboard.%27);},function(){prompt(msg+%27\\nCopy the CSV:%27,text);});}else{prompt(msg+%27\\nCopy the CSV:%27,text);} }catch(err){alert(%27Bookmarklet error: %27+err.message);}})();
